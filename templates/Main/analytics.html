{% extends "base.html" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{url_for('static',filename='css/analytics.css')}}">
{% endblock %}

{% block title %}
Analytics
{% endblock %}

{% block nav %}
<a href="{{ url_for('admin.home') }}" class="nav-item">
  <i class="fas fa-home"></i>
  Dashboard
</a>
{% endblock %}

{% block body %}
<div class="header">
  <div class="page-title">
    <div class="page-title-box">
      <h1>Analytics</h1>
    </div>
  </div>
</div>
<div class="analytics-box">
  <div class="filter-box">
    <form action="{{ url_for('admin.analytics') }}" method="post">
      <select name="filter" id="">
        <option value="1">January</option>
        <option value="2">February</option>
        <option value="3">March</option>
        <option value="4">April</option>
        <option value="5">May</option>
        <option value="6">June</option>
        <option value="7">July</option>
        <option value="8">August</option>
        <option value="9">September</option>
        <option value="10">October</option>
        <option value="11">November</option>
        <option value="12">December</option>
      </select>
      <button type="submit">Submit</button>
    </form>
  </div>
  <div class="analytics-details">
    <ol>
      {% if diagnosis_disease_ids %}
      {% for diagnosis_disease_id, count in diagnosis_disease_ids %}
      <li>
        {% for diagnosis_detail in diagnosis_details if diagnosis_detail.id == diagnosis_disease_id %}
        {% for disease in diseases if disease.id == diagnosis_detail.disease_id %}
        <details>
          <summary><b>{{ disease.name }}</b> - diagnosed {{ count }} time(s)</summary>
          {% for each_diagnosis in all_diagnosis if each_diagnosis.id == diagnosis_detail.diagnosis_id %}
          {% for patient in patients if patient.id == each_diagnosis.patient_id %}
          <details>
            <summary><b>Region(s): </b>{{ patient.patient_address.region }}, {{ patient.patient_address.district }}
            </summary>
            <p><b>Patient: </b>{{ patient.first_name }} {{ patient.last_name }}</p>
            <p>
              <b>Appointment: </b>
              <a target="_blank"
                href="{{ url_for('admin.appointment', appointment_id=each_diagnosis.appointment_diagnosis.unique_id) }}">#{{
                each_diagnosis.appointment_id }}
            </p></a>
          </details>
          {% endfor %}
          {% endfor %}
        </details>
        {% endfor %}
        {% endfor %}
      </li>
      {% endfor %}
      {% else %}
      <p>No data found</p>
      {% endif %}
    </ol>
    <br><br>
    <ol>
      {% for prescription_medicine_id, counts in prescription_medicine_ids %}
      <li>
        {% for medicine in medicines if medicine.id == prescription_medicine_id %}
        <b>{{ medicine.name }}</b> - prescribed {{ counts }} time(s)
        {% endfor %}
      </li>
      {% endfor %}
    </ol>
  </div>
</div>
{% endblock %}

{% block script %}
{% endblock %}